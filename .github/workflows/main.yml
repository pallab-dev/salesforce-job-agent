name: Salesforce Job Agent (FREE Groq)

on:
  schedule:
    - cron: "0 */8 * * *"   # every 8 hours
  workflow_dispatch:

jobs:
  run-agent:
    runs-on: ubuntu-latest

    steps:
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install requests

      - name: Run AI Job Agent
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        run: |
          python - << 'EOF'
          import requests, os, json

          GROQ_API_KEY = os.getenv("GROQ_API_KEY")

          # Fetch remote jobs
          jobs = requests.get("https://remoteok.com/api").json()[1:]
          sf_jobs = [j for j in jobs if "salesforce" in j["position"].lower()]

          if not sf_jobs:
              print("No Salesforce jobs found.")
              exit()

          # Take first 5 jobs
          sf_jobs = sf_jobs[:5]

          # Prepare prompt
          prompt = f"""
          You are filtering jobs for a Salesforce professional with 6+ years experience.
          Accept roles: Developer, Admin, Consultant, Architect.
          Only remote global jobs.
          Reject junior roles.

          Jobs:
          {sf_jobs}
          """

          # Call Groq Llama 3 API
          response = requests.post(
              "https://api.groq.com/openai/v1/chat/completions",
              headers={
                  "Authorization": f"Bearer {GROQ_API_KEY}",
                  "Content-Type": "application/json"
              },
              json={
                  "model": "llama3-70b-8192",
                  "messages": [{"role":"user","content": prompt}]
              }
          )

          print("==== AI FILTERED JOBS ====")
          print(response.json()["choices"][0]["message"]["content"])
          EOF
